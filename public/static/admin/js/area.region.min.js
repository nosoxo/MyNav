function CREATE_REGION() {

    return {

        config : {
            eml : '#area-picker'
        },

        init : function( eml ) {
            that            = this;
            this.config.eml = eml;
            filter          = '-' + eml.replace( '#', '' );
            layui.form.on( 'select(province' + filter + ')', function( data ) {
                id = data.value;
                that.selectId( id, eml );
                that.getPid( id, 'city', eml );
            } );
            layui.form.on( 'select(city' + filter + ')', function( data ) {
                id = data.value;
                that.selectId( id, eml );
                that.getPid( id, 'county', eml );
            } );
            layui.form.on( 'select(county' + filter + ')', function( data ) {
                id = data.value;
                that.selectId( id, eml );
                that.getPid( id, 'town', eml );
            } );
            layui.form.on( 'select(town' + filter + ')', function( data ) {
                id = data.value;
                that.selectId( id, eml );
                that.getPid( id, 'community', eml );
            } );
            this.selectDefault( eml );
        },

        selectDefault : function( eml ) {
            that      = this;
            region_id = $( eml ).find( '.region-selector' ).val();
            if( region_id ) {
                $.ajax(
                    {
                        type       : 'GET',
                        url        : '/region/get_info',
                        data       : { 'id' : region_id, 'eml' : eml },
                        dataType   : 'json',
                        beforeSend : function() {

                        },
                        complete   : function() {

                        },
                        error      : function() {
                            console.log( '获取默认地区信息错误' );
                        },
                        success    : function( json ) {
                            if( json.code === 0 ) {
                                eml = json.eml;
                                //console.log( 'sd - region_id:', region_id, ', json:', json );
                                if( json.data.province_id ) {
                                    $( eml ).find( '.province-selector' ).data( 'value', json.data.province_id )
                                }
                                if( json.data.city_id ) {
                                    $( eml ).find( '.city-selector' ).data( 'value', json.data.city_id )
                                }
                                if( json.data.county_id ) {
                                    $( eml ).find( '.county-selector' ).data( 'value', json.data.county_id )
                                }
                                if( json.data.town_id ) {
                                    $( eml ).find( '.town-selector' ).data( 'value', json.data.town_id )
                                    if($( eml ).find( '.town-selector' ).length === 0){
                                        $( eml ).find( '.county-selector' ).data( 'value', json.data.town_id )
                                    }
                                }
                                if( json.data.community_id ) {
                                    $( eml ).find( '.community-selector' ).data( 'value', json.data.community_id )
                                }
                                that.getPid( 0, 'province', eml )
                            }
                        }
                    }
                );
            } else {
                //默认获取省份
                this.getPid( 0, 'province', eml );
            }
        },

        selectId : function( id, eml ) {
            if( id == '' ) {
                //如果下级为空，获取上一级
                if($(".province-selector").val()){
                    id = $(".province-selector").val();
                }
                if($(".city-selector").val()){
                    id = $(".city-selector").val();
                }
                if($(".county-selector").val()){
                    id = $(".county-selector").val();
                }
                if($(".town-selector").val()){
                    id = $(".town-selector").val();
                }
            }
            $( eml ).find( '.region-selector' ).val( id );
        },

        toHtml : function( area, data, eml ) {
            var str     = this.getDefault( area );

            //console.log( 'toHtml - eml:', eml, ', this.config.eml:', this.config.eml, ', area:', area, ', data:', data );

            default_val = $( eml ).find( '.' + area + '-selector' ).data( 'value' );

            data.forEach( function( val, ind ) {
                selected = val.id == default_val ? 'selected' : '';
                str += '<option value="' + val.id + '" ' + selected + '>' + val.name + '</option>';
            } );

            $( eml ).find( '.' + area + '-selector' ).data( 'value', '' ).html( str );

            filter = area + '-' + eml.replace( '#', '' );

            console.log( 'toHtml - filter:', filter, ', default_val:', default_val, ', eml:', eml, ', this.config.eml:', this.config.eml );

            layui.form.render( 'select' );
            //更新下一级

            switch( area ) {
                case 'province':
                    that.getPid( default_val, 'city', eml );
                    break;
                case 'city':
                    that.getPid( default_val, 'county', eml );
                    break;
                case 'county':
                    that.getPid( default_val, 'town', eml );
                    break;
                case 'town':
                    that.getPid( default_val, 'communtiy', eml );
                    break;
            }
        },

        getDefault : function( area ) {
            switch( area ) {
                case 'province':
                    return '<option value="">请选择省</option>';
                    break;
                case 'city':
                    return '<option value="">请选择市</option>';
                    break;
                case 'county':
                    return '<option value="">请选择区</option>';
                    break;
                case 'town':
                    return '<option value="">请选择镇</option>';
                    break;
                case 'community':
                    return '<option value="">请选择社区</option>';
                    break;
            }
        },

        getPid : function( pid, area, eml ) {
            //if( ! eml || eml == '' ) eml = this.config.eml;
            that = this;
            if( pid === '' || pid === undefined || pid == 'undefined' ) {
                that.toHtml( area, [], eml );
                return false;
            }
            $.ajax(
                {
                    type       : 'GET',
                    url        : '/region/get_pid',
                    data       : { 'pid' : pid, 'eml' : eml },
                    dataType   : 'json',
                    beforeSend : function() {
                        // loading = layer.load(2)
                    },
                    complete   : function() {
                        // layer.close(loading)
                    },
                    error      : function() {
                        console.log( '获取地区信息错误' );
                    },
                    success    : function( json ) {
                        if( json.code === 0 ) {
                            //console.log( 'getPid - json:', json );
                            that.toHtml( area, json.data, json.eml )
                        }
                    }
                }
            );
        }
    }

};

REGION = new CREATE_REGION();
